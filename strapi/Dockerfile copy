FROM node:20-alpine as base

WORKDIR /app

COPY package.json package-lock.json /app/

# Requires buildkit, not available in GCP
#RUN --mount=type=cache,target=/root/.npm

RUN npm install --frozen-lockfile

FROM base as production

ENV NODE_ENV=production

COPY . /app/

RUN yarn build

CMD [ "node_modules/.bin/strapi", "start" ]
